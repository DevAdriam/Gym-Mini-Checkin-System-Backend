// ---------- GENERATORS ----------
generator client {
  provider = "prisma-client-js"
  schema   = "public"
}

generator erd {
  provider = "prisma-erd-generator"
  output   = "./ERD.md"
  schema   = "public"
}

// ---------- DATASOURCE ----------
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ---------- MODELS ----------
model Admin {
  id          String        @id @default(uuid())
  name        String
  email       String        @unique
  phone       String?
  password    String
  image       String?
  status      ADMIN_STATUS  @default(ACTIVE)
  lastLoginAt DateTime?     @map("last_login_at")

  deletedAt   DateTime?     @map("deleted_at")
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt() @map("updated_at")

  @@map("admins")
}

model Member {
  id                  String                    @id @default(uuid())
  name                String
  phone               String?
  email               String?
  profilePhoto        String?                   @map("profile_photo")

  memberId            String                    @unique @map("member_id")

  status              MEMBER_STATUS             @default(PENDING)

  membershipPackageId String                   @map("membership_package_id")
  membershipPackage   MembershipPackage        @relation(fields: [membershipPackageId], references: [id])

  startDate           DateTime?                 @map("start_date")
  endDate             DateTime?                 @map("end_date")

  paymentScreenshots   MemberPaymentScreenshot[]
  checkInLogs         CheckInLog[]

  deletedAt           DateTime?                 @map("deleted_at") // Soft delete

  createdAt           DateTime                  @default(now()) @map("created_at")
  updatedAt           DateTime                  @updatedAt() @map("updated_at")

  @@map("members")
}

model MembershipPackage {
  id           String    @id @default(uuid())
  title        String
  description  String?
  price        Int
  durationDays Int       @map("duration_days")
  isActive     Boolean   @default(true)
  sortOrder    Int?      @map("sort_order")

  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt() @map("updated_at")
  deletedAt    DateTime? @map("deleted_at")

  members      Member[]

  @@map("membership_packages")
}



model MemberPaymentScreenshot {
  id          String   @id @default(uuid())
  memberId    String   @map("member_id")
  imageUrl    String   @map("image_url")
  description String?  

  member      Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)

  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt() @map("updated_at")

  @@index([memberId])
  @@map("member_payment_screenshots")
}

model CheckInLog {
  id          String          @id @default(uuid())
  memberId    String          @map("member_id")
  checkInTime DateTime        @default(now()) @map("check_in_time")
  checkOutTime DateTime?      @map("check_out_time")
  status      CHECKIN_STATUS
  reason      String?

  createdAt   DateTime        @default(now()) @map("created_at")

  member      Member          @relation(fields: [memberId], references: [id])

  @@index([memberId])
  @@index([checkInTime])
  @@map("check_in_logs")
}

enum CHECKIN_STATUS {
  ALLOWED
  DENIED
}

enum ADMIN_STATUS {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum PAYMENT_METHOD {
  AYA_PAY
  KPAY
  WAVE
  CREDIT_CARD
  BANK_TRANSFER
  OTHER
}


enum MEMBER_STATUS {
  PENDING
  APPROVED
  REJECTED
}
